@using StoreManagementAPI.Models
@using Blazorise

<Card class="card-shadow-lg max-w-4xl mx-auto">
    <!-- Invoice Header -->
    <div class="bg-white border-b-2 border-black px-8 py-6">
        <div class="flex flex-wrap justify-between items-center gap-4">
            <div>
                <Heading Size="HeadingSize.Is3" class="mb-1 text-black font-bold">
                    <Icon Name="Blazorise.Icons.FontAwesome.FontAwesomeIcons.Store" class="mr-2" /> E-Store
                </Heading>
                <Paragraph class="text-gray-600 mb-0 text-sm">Your trusted online shopping destination</Paragraph>
            </div>
            <div class="text-right">
                <Heading Size="HeadingSize.Is4" class="mb-1 text-black font-bold">INVOICE</Heading>
                <Paragraph class="text-gray-700 mb-0 text-sm font-semibold">#INV-@Order.OrderId.ToString("D6")</Paragraph>
            </div>
        </div>
    </div>

    <CardBody class="p-8">
        <!-- Invoice Info -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
            <div>
                <Heading Size="HeadingSize.Is6" class="uppercase tracking-wide mb-3 text-xs font-bold text-gray-700">Bill To</Heading>
                @if (Order.Customer != null)
                {
                    <Heading Size="HeadingSize.Is6" class="mb-2 text-black font-bold">@Order.Customer.Name</Heading>
                    @if (!string.IsNullOrEmpty(Order.Customer.Address))
                    {
                        <Paragraph class="mb-1 text-sm text-black">@Order.Customer.Address</Paragraph>
                    }
                    @if (!string.IsNullOrEmpty(Order.Customer.Email))
                    {
                        <Paragraph class="mb-1 text-sm text-black">@Order.Customer.Email</Paragraph>
                    }
                    @if (!string.IsNullOrEmpty(Order.Customer.Phone))
                    {
                        <Paragraph class="mb-0 text-sm text-black">@Order.Customer.Phone</Paragraph>
                    }
                }
                else
                {
                    <Paragraph class="text-gray-600 text-sm">Guest Customer</Paragraph>
                }
            </div>
            <div class="md:text-right">
                <div class="space-y-2">
                    <div class="flex justify-between md:justify-end md:gap-8 text-sm">
                        <span class="text-gray-600">Invoice Date:</span>
                        <span class="font-semibold text-black">@DateTime.Now.ToString("MMM dd, yyyy")</span>
                    </div>
                    <div class="flex justify-between md:justify-end md:gap-8 text-sm">
                        <span class="text-gray-600">Order Date:</span>
                        <span class="font-semibold text-black">@Order.OrderDate.ToString("MMM dd, yyyy")</span>
                    </div>
                    <div class="flex justify-between md:justify-end md:gap-8 items-center text-sm">
                        <span class="text-gray-600">Status:</span>
                        <span class="@GetStatusBadgeClass(Order.Status) px-3 py-1 rounded-full text-xs font-semibold text-white inline-block">@Order.Status.ToUpper()</span>
                    </div>
                    @if (Order.Payments.Any())
                    {
                        <div class="flex justify-between md:justify-end md:gap-8 text-sm">
                            <span class="text-gray-600">Payment:</span>
                            <span class="font-semibold text-black">@GetPaymentMethodDisplay(Order.Payments.First().PaymentMethod)</span>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Invoice Items Table -->
        <Table Striped class="mb-8">
            <TableHeader class="bg-gray-100">
                <TableRow>
                    <TableHeaderCell class="w-1/2 text-xs font-bold text-black uppercase">Description</TableHeaderCell>
                    <TableHeaderCell TextAlignment="TextAlignment.Center" class="text-xs font-bold text-black uppercase">Quantity</TableHeaderCell>
                    <TableHeaderCell TextAlignment="TextAlignment.End" class="text-xs font-bold text-black uppercase">Unit Price</TableHeaderCell>
                    <TableHeaderCell TextAlignment="TextAlignment.End" class="text-xs font-bold text-black uppercase">Amount</TableHeaderCell>
                </TableRow>
            </TableHeader>
            <TableBody>
                @foreach (var item in Order.OrderItems)
                {
                    <TableRow>
                        <TableRowCell class="text-sm">
                            <strong class="text-black">@item.Product?.ProductName</strong>
                            @if (!string.IsNullOrEmpty(item.Product?.Unit))
                            {
                                <br /><small class="text-gray-600 text-xs">Unit: @item.Product.Unit</small>
                            }
                        </TableRowCell>
                        <TableRowCell TextAlignment="TextAlignment.Center" class="text-sm text-black">@item.Quantity</TableRowCell>
                        <TableRowCell TextAlignment="TextAlignment.End" class="text-sm text-black">$@item.Price.ToString("N2")</TableRowCell>
                        <TableRowCell TextAlignment="TextAlignment.End" class="text-sm font-semibold text-black">$@item.Subtotal.ToString("N2")</TableRowCell>
                    </TableRow>
                }
            </TableBody>
        </Table>

        <!-- Invoice Summary -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <Card class="!border-0 !shadow-none">
                <CardBody>
                    <Heading Size="HeadingSize.Is6" class="mb-3 text-sm font-bold text-black uppercase">Payment Information</Heading>
                    @if (Order.Payments.Any())
                    {
                        var payment = Order.Payments.First();
                        <Paragraph class="mb-1 text-sm">
                            <small class="text-gray-600 text-xs">Method:</small> <span class="text-black font-medium">@GetPaymentMethodDisplay(payment.PaymentMethod)</span>
                        </Paragraph>
                        <Paragraph class="mb-1 text-sm">
                            <small class="text-gray-600 text-xs">Date:</small> <span class="text-black font-medium">@payment.PaymentDate.ToString("MMM dd, yyyy hh:mm tt")</span>
                        </Paragraph>
                        <Paragraph class="mb-0 text-sm">
                            <small class="text-gray-600 text-xs">Status:</small>
                            <span class="text-green-600 font-semibold">Paid</span>
                        </Paragraph>
                    }
                    else
                    {
                        <Paragraph class="text-red-600 mb-0 text-sm font-semibold">Payment Pending</Paragraph>
                    }
                </CardBody>
            </Card>
            <Card class="!border-0 !shadow-none">
                <CardBody>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-black">Subtotal:</span>
                            <span class="text-black font-medium">$@((Order.TotalAmount + Order.DiscountAmount).ToString("N2"))</span>
                        </div>
                        @if (Order.DiscountAmount > 0)
                        {
                            <div class="flex justify-between text-green-600 text-sm">
                                <span>Discount:</span>
                                <span class="font-medium">-$@Order.DiscountAmount.ToString("N2")</span>
                            </div>
                        }
                        <div class="flex justify-between text-sm">
                            <span class="text-black">Shipping:</span>
                            <span class="text-black font-medium">$0.00</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-black">Tax:</span>
                            <span class="text-black font-medium">$0.00</span>
                        </div>
                        <Divider />
                        <div class="flex justify-between text-lg font-bold">
                            <span class="text-black">Total:</span>
                            <span class="text-black">$@Order.TotalAmount.ToString("N2")</span>
                        </div>
                    </div>
                </CardBody>
            </Card>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8 pt-8 border-t-2 border-gray-300">
            <Paragraph class="mb-1 text-sm font-semibold text-black">Thank you for shopping with us!</Paragraph>
            <Paragraph class="text-xs mb-0 text-gray-600">
                For questions about your order, please contact support@estore.com
            </Paragraph>
        </div>
    </CardBody>
</Card>

@code {
    [Parameter]
    public Order Order { get; set; } = null!;

    private string GetStatusBadgeClass(string status) => status.ToLower() switch
    {
        "pending" => "bg-red-600",
        "completed" => "bg-green-600",
        "cancelled" or "canceled" => "bg-gray-600",
        "processing" => "bg-blue-600",
        "shipped" => "bg-cyan-600",
        _ => "bg-gray-500"
    };

    private string GetPaymentMethodDisplay(string method) => method.ToLower() switch
    {
        "cash" => "Cash on Delivery",
        "card" => "Credit/Debit Card",
        "transfer" => "Bank Transfer",
        _ => method
    };
}
