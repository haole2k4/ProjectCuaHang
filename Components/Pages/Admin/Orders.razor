@page "/admin/orders"
@rendermode InteractiveServer

@using StoreManagementAPI.Data
@using StoreManagementAPI.Models
@using Microsoft.EntityFrameworkCore
@using Blazorise

@inject StoreDbContext DbContext

<PageTitle>Orders - Admin</PageTitle>

<div class="flex justify-between items-center mb-6">
    <div>
        <Heading Size="HeadingSize.Is3" class="text-gray-800 mb-1">Orders</Heading>
        <Paragraph TextColor="TextColor.Muted" class="mb-0">Manage customer orders</Paragraph>
    </div>
    <div class="flex gap-3">
        <Button Color="Color.Light">
            <Icon Name="Blazorise.Icons.FontAwesome.FontAwesomeIcons.Filter" class="mr-2" /> Filter
        </Button>
        <Button Color="Color.Light">
            <Icon Name="Blazorise.Icons.FontAwesome.FontAwesomeIcons.Download" class="mr-2" /> Export
        </Button>
    </div>
</div>

<Card class="shadow-sm border-0">
    <CardBody Padding="Padding.Is0">
        <Table Hoverable class="mb-0">
            <TableHeader>
                <TableRow class="bg-gray-50">
                    <TableHeaderCell class="px-6 py-4">Order ID</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4">Customer</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4">Date</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4">Status</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4 text-right">Amount</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4 text-right">Actions</TableHeaderCell>
                </TableRow>
            </TableHeader>
            <TableBody>
                @if (orders != null && orders.Any())
                {
                    @foreach (var order in orders)
                    {
                        <TableRow>
                            <TableRowCell class="px-6 py-4 font-medium">#ORD-@order.OrderId.ToString("D6")</TableRowCell>
                            <TableRowCell class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-8 h-8 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white text-xs font-semibold">
                                        @(order.Customer?.Name?.Substring(0, 1).ToUpper() ?? "G")
                                    </div>
                                    @(order.Customer?.Name ?? "Guest")
                                </div>
                            </TableRowCell>
                            <TableRowCell class="px-6 py-4">@order.OrderDate.ToString("MMM dd, yyyy")</TableRowCell>
                            <TableRowCell class="px-6 py-4">
                                <Badge Color="@GetStatusColor(order.Status)">@order.Status</Badge>
                            </TableRowCell>
                            <TableRowCell class="px-6 py-4 text-right font-semibold">$@order.TotalAmount.ToString("N2")</TableRowCell>
                            <TableRowCell class="px-6 py-4 text-right">
                                <Buttons>
                                    <Button Color="Color.Light" Size="Size.Small">
                                        <Icon Name="Blazorise.Icons.FontAwesome.FontAwesomeIcons.Eye" />
                                    </Button>
                                    <Button Color="Color.Light" Size="Size.Small">
                                        <Icon Name="Blazorise.Icons.FontAwesome.FontAwesomeIcons.Edit" />
                                    </Button>
                                </Buttons>
                            </TableRowCell>
                        </TableRow>
                    }
                }
                else
                {
                    <TableRow>
                        <TableRowCell ColumnSpan="6" class="text-center py-8 text-gray-500">
                            No orders found
                        </TableRowCell>
                    </TableRow>
                }
            </TableBody>
        </Table>
    </CardBody>
</Card>

@code {
    private List<Order>? orders;

    protected override async Task OnInitializedAsync()
    {
        orders = await DbContext.Orders
            .Include(o => o.Customer)
            .OrderByDescending(o => o.OrderDate)
            .Take(50)
            .ToListAsync();
    }

    private Color GetStatusColor(string status) => status.ToLower() switch
    {
        "pending" => Color.Warning,
        "completed" or "paid" => Color.Success,
        "cancelled" or "canceled" => Color.Danger,
        "processing" => Color.Info,
        _ => Color.Secondary
    };
}
