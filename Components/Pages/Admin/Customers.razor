@page "/admin/customers"
@rendermode InteractiveServer

@using StoreManagementAPI.Data
@using StoreManagementAPI.Models
@using Microsoft.EntityFrameworkCore
@using Blazorise

@inject StoreDbContext DbContext

<PageTitle>Customers - Admin</PageTitle>

<div class="flex justify-between items-center mb-6">
    <div>
        <Heading Size="HeadingSize.Is3" class="text-gray-800 mb-1">Customers</Heading>
        <Paragraph TextColor="TextColor.Muted" class="mb-0">Manage your customer base</Paragraph>
    </div>
    <Button Color="Color.Primary">
        <Icon Name="Blazorise.Icons.FontAwesome.FontAwesomeIcons.Plus" class="mr-2" /> Add Customer
    </Button>
</div>

<Card class="shadow-sm border-0">
    <CardBody Padding="Padding.Is0">
        <Table Hoverable class="mb-0">
            <TableHeader>
                <TableRow class="bg-gray-50">
                    <TableHeaderCell class="px-6 py-4">Customer</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4">Email</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4">Phone</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4">Orders</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4">Status</TableHeaderCell>
                    <TableHeaderCell class="px-6 py-4 text-right">Actions</TableHeaderCell>
                </TableRow>
            </TableHeader>
            <TableBody>
                @if (customers != null && customers.Any())
                {
                    @foreach (var customer in customers)
                    {
                        <TableRow>
                            <TableRowCell class="px-6 py-4">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold">
                                        @customer.Name?.Substring(0, 1).ToUpper()
                                    </div>
                                    <div>
                                        <div class="font-medium">@customer.Name</div>
                                        <div class="text-gray-500 text-sm">Since @customer.CreatedAt.ToString("MMM yyyy")</div>
                                    </div>
                                </div>
                            </TableRowCell>
                            <TableRowCell class="px-6 py-4">@customer.Email</TableRowCell>
                            <TableRowCell class="px-6 py-4">@customer.Phone</TableRowCell>
                            <TableRowCell class="px-6 py-4">@customer.Orders.Count</TableRowCell>
                            <TableRowCell class="px-6 py-4">
                                <Badge Color="@(customer.Status == "active" ? Color.Success : Color.Secondary)">
                                    @customer.Status
                                </Badge>
                            </TableRowCell>
                            <TableRowCell class="px-6 py-4 text-right">
                                <Buttons>
                                    <Button Color="Color.Light" Size="Size.Small">
                                        <Icon Name="Blazorise.Icons.FontAwesome.FontAwesomeIcons.Eye" />
                                    </Button>
                                    <Button Color="Color.Light" Size="Size.Small">
                                        <Icon Name="Blazorise.Icons.FontAwesome.FontAwesomeIcons.Edit" />
                                    </Button>
                                </Buttons>
                            </TableRowCell>
                        </TableRow>
                    }
                }
                else
                {
                    <TableRow>
                        <TableRowCell ColumnSpan="6" class="text-center py-8 text-gray-500">
                            No customers found
                        </TableRowCell>
                    </TableRow>
                }
            </TableBody>
        </Table>
    </CardBody>
</Card>

@code {
    private List<Customer>? customers;

    protected override async Task OnInitializedAsync()
    {
        customers = await DbContext.Customers
            .Include(c => c.Orders)
            .OrderByDescending(c => c.CreatedAt)
            .Take(50)
            .ToListAsync();
    }
}
